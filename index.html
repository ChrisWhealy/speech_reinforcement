<!DOCTYPE html>
<html>
<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
  <link rel="stylesheet" href="./style.css" />
  <title>Speech Reinforcement Calculator (SRC)</title>
  <script src="./js/src.js"></script>
  <script type="module">
      // Get reference to the JavaScript wrapper function generated by wasm-pack
      import init, { pag_calculator } from './pkg/speech_reinforcement.js'
  
      // Make JavaScript wrapper function accessible to coding outside this module
      window.pag_calculator = pag_calculator
  
      // Start the engine...
      async function run() {
        await init()
        console.log("WASM module initialisation complete...")
        update_screen()
      }
  
      // Off we go...
      run()
    </script>
  </head>

<body>
  <h1>Speech Reinforcement Calculator (SRC)</h1>

  <!-- Summary table -->
  <div class="summary_table">
    <div class="summary_row">
      <div class="summary_cell term">Potential Acoustic Gain (PAG)</div>
      <div class="summary_cell"><input type="number" readonly id="pag"> dB</div>
      <div class="summary_cell definition">Maximum theoretical gain that can be achieved without feedback</div>
    </div>

    <div class="summary_row">
      <div class="summary_cell term">Gain lost through NoM</div>
      <div class="summary_cell"><input type="number" readonly id="nom_gain_loss"> dB</div>
      <div class="summary_cell definition">Every open mic creates a potential feedback path and thus reduces your PAG</div>
    </div>

    <div class="summary_row">
      <div class="summary_cell term">PAG after accounting for NoM</div>
      <div class="summary_cell"><input type="number" readonly id="pag_after_nom"> dB</div>
      <div class="summary_cell definition">PAG minus gain loss due to NoM</div>
    </div>

    <div class="summary_row">
      <div class="summary_cell term">PAG after accounting for NoM and FSM</div>
      <div class="summary_cell"><input type="number" readonly id="pag_after_nom_fsm"> dB</div>
      <div class="summary_cell definition">To avoid running the system on the verge of feedback, the PAG value is further reduced by the FSM</div>
    </div>

    <div class="summary_row">
      <div class="summary_cell term">Needed Acoustic Gain (NAG)</div>
      <div class="summary_cell"><input type="number" readonly id="nag"> dB</div>
      <div class="summary_cell definition">The gain required for the farthest listener to hear the talker at the same level as the nearest listener</div>
    </div>

    <div class="summary_row">
      <div class="summary_cell term">Should you be safe from feedback?</div>
      <div class="summary_cell_image"><span id="safe"></span></div>
      <div class="summary_cell definition">As long as <tt>(PAG - NoM - FSM) &gt; NAG</tt> is true, then you should be safe from feedback</div>
    </div>
  </div>

  <!-- Input parameters table -->
  <div class="param_table">
    <div class="param_row">
      <div class="param_cell_hdr">Distance from the Talker</div>
    </div>

    <div class="param_row">
      <div class="param_cell desc">To their microphone</div>
      <div class="param_cell"><input type="range" min="0.01" max="1.0" step="0.01" value="0.1" id="source_to_mic" oninput="update_screen()"></div>
      <div class="param_cell unit" id="source_to_mic_value"></div>
      <div class="param_cell unit" id="source_to_mic_units"></div>
    </div>

    <div class="param_row">
      <div class="param_cell desc">To the nearest listener</div>
      <div class="param_cell"><input type="range" min="1.0" max="20.0" step="0.1" value="4.0" id="source_to_listener" oninput="update_screen()"></div>
      <div class="param_cell unit" id="source_to_listener_value"></div>
      <div class="param_cell unit" id="source_to_listener_units"></div>
    </div>

    <div class="param_row">
      <div class="param_cell desc">To the farthest listener</div>
      <div class="param_cell"><input type="range" min="2.0" max="50.0" step="0.1" value="10.0" id="source_to_listener_max" oninput="update_screen()"></div>
      <div class="param_cell unit" id="source_to_listener_max_value"></div>
      <div class="param_cell unit" id="source_to_listener_max_units"></div>
    </div>

    <div class="param_row">
      <div class="param_cell_hdr">Distance to the Nearest Loud Speaker</div>
    </div>

    <div class="param_row">
      <div class="param_cell desc">From the talker's microphone</div>
      <div class="param_cell"><input type="range" min="2.0" max="20.0" step="0.1" value="6.0" id="speaker_to_mic" oninput="update_screen()"></div>
      <div class="param_cell unit" id="speaker_to_mic_value"></div>
      <div class="param_cell unit" id="speaker_to_mic_units"></div>
    </div>

    <div class="param_row">
      <div class="param_cell desc">From the nearest listener</div>
      <div class="param_cell"><input type="range" min="2.0" max="20.0" step="0.1" value="4.0" id="speaker_to_listener" oninput="update_screen()"></div>
      <div class="param_cell unit" id="speaker_to_listener_value"></div>
      <div class="param_cell unit" id="speaker_to_listener_units"></div>
    </div>

    <div class="param_row">
      <div class="param_cell_hdr">Open Microphones and Stability Margin</div>
    </div>

    <div class="param_row">
      <div class="param_cell desc">Number of open mics (NoM)</div>
      <div class="param_cell"><input type="range" min="1" max="20" step="1" value="3" id="nom" oninput="update_screen()"></div>
      <div class="param_cell unit" id="nom_value"></div>
    </div>

    <div class="param_row">
      <div class="param_cell desc">Feedback stability margin (FSM)</div>
      <div class="param_cell"><input type="range" min="1.0" max="18.0" step="0.1" value="6.0" id="fsm" oninput="update_screen()"></div>
      <div class="param_cell unit" id="fsm_value"></div>
    </div>
  </div>

</body>
</html>